<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="css/app.css" />
		<script src="js/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/layer_mobile/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/swiper/js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="js/swiper/css/swiper.css" />
		<script src="js/config.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack: true
			});
			mui.plusReady(function() {
				plus.key.addEventListener("backbutton", onKeyBack, false);
				exitAppToLogin()
			});

			function onKeyBack() {
				plus.runtime.quit();
			}
		</script>
	</head>

	<body>

		<!--to 程序员-->
		<!--a 标签如果需要加 链接跳转，加data-href属性。后面接链接。-->
		<!--<a href="" data-href="如果a链接跳转就把链接写到这里"></a>-->
		<!--<div data-href="如果a链接跳转就把链接写到这里"></div>-->

		<style type="text/css">
			body {
				background: #F1F1F1;
			}
		</style>

		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">注册</h1>
		</header>

		<div class="mui-content login-content">

			<!--banner 轮播-->
			<div class="banner-slider">
				<img src="img/login-img.png" />
			</div>

			<div style="padding:  0 10px;">
				
				<h1 class="mui-text-center" style="padding: 15px 0; font-weight: 100;">
					<span style="color: #F2395B; font-size: 26px;">
						注册分享 有积分领取哦！
					</span>
				</h1>
						
				<form class="mui-input-group">
								<div class="mui-input-row mui-input-row-icons">
									<label class="ico-tel"></label>
									<input id="phone1" name="phone" type="tel" class="mui-input-clear" placeholder="请输入您的手机号">
								</div>
								<div class="mui-input-row mui-input-row-icons">
									<button id="sendSMSBtn" type="button" data-loading-text="" class="mui-btn mui-btn-red  mui-badge-inverted btn-short-message">点击发送验证码</button>
									<label class="ico-password"></label>
									<input id="verfiyCode" type="number" class="mui-input-clear" placeholder="请输入短信验证码" maxlength="6">
								</div>

				</form>
				<button id="verifyCodeBtn" type="button" class="mui-btn mui-btn-red mui-btn-block border-raduis" data-loading-text="登录中">立即注册领取积分</button>
					
			

				<p class="agree-tips">
					
					<a >
						注册有礼，有机会赢取Iphone X
					</a>
				</p>
			</div>

		</div>
		
		<!--2018-11-13 21:55:11 修改--> 
		
		<link rel="stylesheet" href="css/ydui.css">
		<script src="js/ydui.js"></script>
		<script>
			//获取验证码
	        var $getCode = $('#sendSMSBtn');
	
			/* 定义参数 */
	        $getCode.sendCode({
	            disClass: 'mui-disabled',
	            secs: 5,//倒计时多少秒
	            run: false,
	            runStr: '{%s}s',
	            resetStr: '重新获取验证码'
	        });
	        $getCode.on('click', function () {
				
	            YDUI.dialog.loading.open('发送中');
	            
	                
	                mui.ajax(neighborURL + '/sendSMS.req', {
						data: {
							phone: $("#phone1").val()
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；               
						success: function(data) {
							console.log("varifyCode ====" + data);
							YDUI.dialog.loading.close();
							if(data.errorCode == 1) {
								mui.toast(data.errorMessage);
								return;
							}else{ 
								/* ajax 成功发送验证码后调用【start】 */
	                			$getCode.sendCode('start');
	                			YDUI.dialog.toast('已发送', 'success', 500);
//								setTimeout(function() {
//							    }.bind(this), 2000);
							}
						},
						error: function(xhr, type, errorThrown) {
							YDUI.dialog.loading.close();
							//异常处理；
							mui.toast(type);
							console.log("errorThrown ===" + xhr.responseText);
						}
					});
	                
	                
	                
	
	        });
		</script>
		<!--2018-11-13 21:55:11 修改  over--> 
		
		
		
		
		<script src="js/config.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript" charset="utf-8">
			
			mui("#item2mobile").on('tap', '#verifyCodeBtn', function() {
				mui(this).button('loading');
				login('/registerLogin.req', {
					phone: $("#phone1").val(),
					verfiyCode: $("#verfiyCode").val(),
					btnId:'#verifyCodeBtn'
				});
			});

			mui("#item1mobile").on('tap', '#acctLoginBtn', function() {
				mui(this).button('loading');
				login('/accountLogin.req', {
					phone: $("#phone").val(),
					password: $("#password").val(),
					btnId:'#acctLoginBtn'
				});
			});
			var login = function(url, datas) {
				var btnId = datas.btnId;
				console.log("登录");
				mui(btnId).button('loading');
				plus.nativeUI.showWaiting();
				mui.ajax(neighborURL + url, {
					data: datas,
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；               
					success: function(data) {
						plus.nativeUI.closeWaiting();
						
						console.log("token ====" + data.token);
						if(data.errorCode == 1) {
							mui(btnId).button('reset');
							mui.toast(data.errorMessage);
							return;
						}

						console.log("token ===" + data.body.token);
						plus.storage.setItem("token", data.body.token);
						plus.storage.setItem("userAccount", data.body.userAccount);

						gotoUrl("index.html");
						
						// 防止登录成功立刻显示登录按钮
						setTimeout(function(){
							mui(btnId).button('reset');
						},3000)
						
					},
					error: function(xhr, type, errorThrown) {
						//异常处理；
						mui.toast("服务器出了个小差...");
						console.log("errorThrown ===" + xhr.responseText);
						plus.nativeUI.closeWaiting();
						mui(btnId).button('reset');
					}
				});

			}
		</script>
	</body>

</html>